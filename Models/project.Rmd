---
title: "project"
author: "Maya Zhao"
date: '2022-05-06'
output: html_document
---


Attribute Information:

Date Time: Each ten minutes.
Temperature: Weather Temperature of Tetouan city.
Humidity: Weather Humidity of Tetouan city.
Wind Speed of Tetouan city.
general diffuse flows
diffuse flows
power consumption of zone 1 of Tetouan city.
power consumption of zone 2 of Tetouan city.
power consumption of zone 3 of Tetouan city.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
rm(list = ls()) #initialization
```


```{r}
library(tidyverse)
library(data.table)
library(lubridate)
#library(dplyr)
library(lubridate)
library(forecast)
library(xts)
library(zoo)
```

```{r}
# read the real data on July 1 for test
df <- read.csv("Tetuan City power consumption.csv")
colnames(df)
```

```{r}
# check for missing values
sum(is.na(df$Zone1))
```


```{r}
colnames(df)[7] <- "Zone1"
colnames(df)[8] <- "Zone2"
colnames(df)[9] <- "Zone3"
```



## EDA
### check stationarity 
```{r}
# ts plot and acf plot
var = colnames(df)
var = var[-1]
for(i in var) {       
  ts.plot(df[[i]], ylab=i)
  acf(df[[i]], ylab = paste0(i," ACF"), main="")
}
```



```{r}
library(tseries)
for(i in var) {       
  print(adf.test(df[[i]])) # detects stationarity
  print(kpss.test(df[[i]],null = "Trend")) # detects trend stationarity
}
```


```{r}
date <- seq(from=as.POSIXct("2017-01-01 00:00", format = "%Y-%m-%d %H:%M"), length.out = nrow(df), by = "10 min")
df$DateTime <- date #df(df$DateTime, format="%m/%d/%Y %H:%M")
#attr(df$DateTime, "tzone") <- "Africa/Casablanca"

df$year <- year(df$DateTime)
df$month <- month(df$DateTime)
df$week <- week(df$DateTime)
df$day <- day(df$DateTime)
df$hour <- hour(df$DateTime)
df$minute <- minute(df$DateTime)
```

## train test split
```{r}
df_xts <- xts(df[,7], date) 
```

### daily
```{r}
train_daily <- df_xts['2017-01-01/2017-12-29']
test_daily <- df_xts['2017-12-30']
plot(train_daily, xlab = "Time", ylab = "Watt Hours", main = "Zone 1 Power Consumption")
plot(test_daily, xlab = "Time", ylab = "Watt Hours", main = "Zone 1 Power Consumption")
```

### weekly
```{r}
#df_weekly <- filter(df,week == 1)
#Z1_weekly <- ts(df_weekly$Zone1, frequency=6*24*52, start=c(2017,1))
#plot(Z1_weekly, xlab = "Time", ylab = "Watt Hours", main = "Zone 1 Power Consumption")
```


```{r}
train_weekly <- df_xts['2017-01-01/2017-12-23']
test_weekly <- df_xts['2017-12-24/2017-12-30']
plot(train_weekly, xlab = "Time", ylab = "Watt Hours", main = "Zone 1 Power Consumption")
plot(test_weekly, xlab = "Time", ylab = "Watt Hours", main = "Zone 1 Power Consumption")
```

### monthly
```{r}
train_monthly <- df_xts['2017-01-01/2017-11-30']
test_monthly <- df_xts['2017-12-01/2017-12-30']
plot(train_monthly, xlab = "Time", ylab = "Watt Hours", main = "Zone 1 Power Consumption")
plot(test_monthly, xlab = "Time", ylab = "Watt Hours", main = "Zone 1 Power Consumption")
```



# Seasonal Arima

## daily
```{r}
fit_daily = auto.arima(ts(train_daily,frequency = 6*24), seasonal = T)
fit_daily
```
```{r}
# AIC

```


```{r}
pred_daily <- forecast(fit_daily, h=nrow(test_daily))
pred_df_daily <- data.frame(hours=index(test_daily), test_val=test_daily[,1], pred_val=pred_daily$mean)
d<- melt(pred_df_daily, id.vars = "hours")
ggplot(d, aes(x=hours, y=value, color=variable)) + 
  geom_point(size=1) + 
  geom_line()
```



## weekly
```{r}
fit_weekly = auto.arima(ts(train_weekly,frequency = 6*24*52), seasonal = T)
fit_weekly
```

```{r}

```


```{r}
pred_weekly <- forecast(fit_weekly, h=nrow(test_weekly))
pred_df_weekly <- data.frame(hours=index(test_weekly), test_val=test_weekly[,1], pred_val=pred_weekly$mean)
d<- melt(pred_df_weekly, id.vars = "hours")
ggplot(d, aes(x=hours, y=value, color=variable)) + 
  geom_point(size=1) + 
  geom_line()
```


## monthly
### train test split
```{r}
fit_monthly = stlf(ts(train_monthly,frequency = 6*24*30))
fit_monthly
```
```{r}
pred_monthly <- forecast(fit_monthly, h=nrow(test_monthly))
pred_df_monthly <- data.table(time=index(test_monthly), test_val=test_monthly[,1], pred_val=pred_monthly$mean)
d<- melt(pred_df_monthly, id.vars = "time")
ggplot(d, aes(x=time, y=value, color=variable)) + 
  geom_point(size=1) + 
  geom_line()
```








```{r}

```








































